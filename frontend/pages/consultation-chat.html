<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Consultation - HealthCare AI</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .chat-page {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--color-bg-subtle);
        }

        /* Chat Header */
        .chat-header {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            padding: var(--space-4);
            background: var(--color-white);
            border-bottom: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .back-btn {
            padding: var(--space-2);
            background: transparent;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
        }

        .back-btn:hover {
            background: var(--color-bg-muted);
            color: var(--color-text);
        }

        .chat-avatar {
            width: 44px;
            height: 44px;
            background: var(--color-primary);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
        }

        .chat-title-section {
            flex: 1;
        }

        .chat-title {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            font-size: var(--font-size-base);
        }

        .chat-status {
            font-size: var(--font-size-sm);
            color: var(--color-success);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--color-success);
            border-radius: var(--radius-full);
        }

        .chat-actions {
            display: flex;
            gap: var(--space-2);
        }

        /* Chat Container */
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        /* Messages */
        .message {
            display: flex;
            gap: var(--space-3);
            max-width: 85%;
            animation: fadeInUp 0.3s ease-out;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: var(--color-white);
        }

        .message.ai .message-avatar {
            background: var(--color-primary);
        }

        .message.user .message-avatar {
            background: var(--color-text-light);
        }

        .message-content {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .message-bubble {
            padding: var(--space-4);
            border-radius: var(--radius-xl);
            line-height: var(--line-height-relaxed);
            font-size: var(--font-size-sm);
        }

        .message.ai .message-bubble {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            color: var(--color-text);
        }

        .message.user .message-bubble {
            background: var(--color-primary);
            color: var(--color-white);
        }

        .message-time {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            padding: 0 var(--space-2);
        }

        .message.user .message-time {
            text-align: right;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) 0;
        }

        .typing-indicator .message-avatar {
            width: 36px;
            height: 36px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            padding: var(--space-4);
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: var(--color-text-muted);
            border-radius: var(--radius-full);
            animation: typingBounce 1.4s infinite ease-in-out;
        }

        .typing-dots span:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {

            0%,
            80%,
            100% {
                transform: scale(0.8);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Quick Responses */
        .quick-responses {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4);
            background: var(--color-white);
            border-top: 1px solid var(--color-border);
        }

        .quick-response {
            padding: var(--space-2) var(--space-4);
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            color: var(--color-text-light);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .quick-response:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        /* Input Area */
        .chat-input-area {
            padding: var(--space-4);
            background: var(--color-white);
            border-top: 1px solid var(--color-border);
        }

        .input-container {
            display: flex;
            align-items: flex-end;
            gap: var(--space-3);
            max-width: 800px;
            margin: 0 auto;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .chat-input {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-xl);
            font-size: var(--font-size-sm);
            resize: none;
            min-height: 44px;
            max-height: 150px;
            transition: border-color var(--transition-fast);
            font-family: var(--font-family);
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .chat-input::placeholder {
            color: var(--color-text-muted);
        }

        .send-btn {
            width: 44px;
            height: 44px;
            background: var(--color-primary);
            border: none;
            border-radius: var(--radius-full);
            color: var(--color-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .send-btn:hover {
            background: var(--color-primary-dark);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Risk Alert */
        .risk-alert {
            margin: var(--space-4) 0;
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: flex-start;
            gap: var(--space-3);
        }

        .risk-alert.critical {
            background: var(--color-danger-bg);
            border: 1px solid var(--color-danger);
        }

        .risk-alert.warning {
            background: var(--color-warning-bg);
            border: 1px solid var(--color-warning);
        }

        .risk-alert.safe {
            background: var(--color-success-bg);
            border: 1px solid var(--color-success);
        }

        .risk-alert-icon {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
        }

        .risk-alert.critical .risk-alert-icon {
            color: var(--color-danger);
        }

        .risk-alert.warning .risk-alert-icon {
            color: var(--color-warning);
        }

        .risk-alert.safe .risk-alert-icon {
            color: var(--color-success);
        }

        .risk-alert-content {
            flex: 1;
        }

        .risk-alert-title {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
            margin-bottom: var(--space-1);
        }

        .risk-alert.critical .risk-alert-title {
            color: var(--color-danger);
        }

        .risk-alert.warning .risk-alert-title {
            color: var(--color-warning);
        }

        .risk-alert.safe .risk-alert-title {
            color: var(--color-success);
        }

        .risk-alert-text {
            font-size: var(--font-size-sm);
            color: var(--color-text-light);
            margin: 0;
        }

        /* Action Buttons in Chat */
        .chat-actions-group {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-top: var(--space-3);
        }

        .chat-action-btn {
            padding: var(--space-2) var(--space-4);
            background: var(--color-white);
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
            border-radius: var(--radius-lg);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .chat-action-btn:hover {
            background: var(--color-primary);
            color: var(--color-white);
        }

        /* End Session */
        .end-session-bar {
            padding: var(--space-3) var(--space-4);
            background: var(--color-bg-subtle);
            text-align: center;
            border-top: 1px solid var(--color-border);
        }

        .end-session-bar button {
            padding: var(--space-2) var(--space-4);
            background: transparent;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            color: var(--color-text-light);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .end-session-bar button:hover {
            background: var(--color-white);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        @media (min-width: 768px) {
            .message {
                max-width: 70%;
            }

            .chat-container {
                padding: var(--space-6);
                max-width: 900px;
                margin: 0 auto;
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div class="chat-page">
        <!-- Chat Header -->
        <div class="chat-header">
            <a href="patient-dashboard.html" class="back-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
            </a>
            <div class="chat-avatar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                </svg>
            </div>
            <div class="chat-title-section">
                <div class="chat-title">AI Health Assistant</div>
                <div class="chat-status">
                    <span class="status-dot"></span>
                    Online
                </div>
            </div>
            <div class="chat-actions">
                <button class="btn btn-ghost btn-icon" title="More options">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="1"></circle>
                        <circle cx="19" cy="12" r="1"></circle>
                        <circle cx="5" cy="12" r="1"></circle>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Chat Messages -->
        <div class="chat-container" id="chat-container">
            <!-- AI Welcome Message -->
            <div class="message ai">
                <div class="message-avatar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                    </svg>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <p style="margin: 0 0 var(--space-3) 0;">Hello! I'm your AI Health Assistant.</p>
                        <p style="margin: 0 0 var(--space-3) 0;">I'm here to help you understand your symptoms and
                            provide guidance. Please remember that I'm an AI and my advice doesn't replace professional
                            medical consultation.</p>
                        <p style="margin: 0;"><strong>How can I help you today?</strong></p>
                    </div>
                    <div class="message-time">Just now</div>
                </div>
            </div>
        </div>

        <!-- Quick Responses -->
        <div class="quick-responses" id="quick-responses">
            <button class="quick-response" onclick="sendQuickResponse('I have a headache')">I have a headache</button>
            <button class="quick-response" onclick="sendQuickResponse('I feel tired and weak')">Feeling tired</button>
            <button class="quick-response" onclick="sendQuickResponse('I have stomach pain')">Stomach pain</button>
            <button class="quick-response" onclick="sendQuickResponse('I have a fever')">Fever symptoms</button>
        </div>

        <!-- End Session -->
        <div class="end-session-bar">
            <button onclick="endSession()">End Consultation & Get Summary</button>
        </div>

        <!-- Input Area -->
        <div class="chat-input-area">
            <div class="input-container">
                <div class="input-wrapper">
                    <textarea class="chat-input" id="chat-input" placeholder="Describe your symptoms..."
                        rows="1"></textarea>
                </div>
                <button class="send-btn" id="send-btn" onclick="sendMessage()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/chat.js"></script>
    <script>
        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const quickResponses = document.getElementById('quick-responses');

        // Auto-resize textarea
        chatInput.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 150) + 'px';
            sendBtn.disabled = !this.value.trim();
        });

        // Send on Enter (Shift+Enter for new line)
        chatInput.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                if (this.value.trim()) {
                    sendMessage();
                }
            }
        });

        function sendMessage() {
            const text = chatInput.value.trim();
            if (!text) return;

            // Hide quick responses after first message
            quickResponses.style.display = 'none';

            // Add user message
            addMessage(text, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';
            sendBtn.disabled = true;

            // Show typing indicator
            showTypingIndicator();

            // Simulate AI response (replace with actual API call)
            setTimeout(() => {
                hideTypingIndicator();
                const response = getAIResponse(text);
                addMessage(response, 'ai');
            }, 1500);
        }

        function sendQuickResponse(text) {
            chatInput.value = text;
            sendMessage();
        }

        function addMessage(text, sender) {
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const avatarIcon = sender === 'ai'
                ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>'
                : '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>';

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatarIcon}</div>
                <div class="message-content">
                    <div class="message-bubble">${text}</div>
                    <div class="message-time">${time}</div>
                </div>
            `;

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'typing-indicator';
            indicator.id = 'typing-indicator';
            indicator.innerHTML = `
                <div class="message-avatar" style="background: var(--color-primary);">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                </div>
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatContainer.appendChild(indicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }

        function getAIResponse(userMessage) {
            const lower = userMessage.toLowerCase();

            if (lower.includes('headache')) {
                return `I understand you're experiencing a headache. Let me ask a few questions to better understand your condition:

<div class="chat-actions-group">
  <button class="chat-action-btn" onclick="sendQuickResponse('Mild headache')">Mild</button>
  <button class="chat-action-btn" onclick="sendQuickResponse('Moderate headache')">Moderate</button>
  <button class="chat-action-btn" onclick="sendQuickResponse('Severe headache')">Severe</button>
</div>

<p style="margin-top: var(--space-3); font-size: var(--font-size-sm); color: var(--color-text-muted);">How would you rate the intensity?</p>`;
            }

            if (lower.includes('fever')) {
                return `Fever can indicate your body is fighting an infection.

<strong>Quick questions:</strong>
<ul style="margin: var(--space-2) 0; padding-left: var(--space-5);">
<li>What is your current temperature?</li>
<li>How long have you had the fever?</li>
<li>Any other symptoms like chills, sweating, or body aches?</li>
</ul>

<div class="risk-alert warning">
  <svg class="risk-alert-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
    <line x1="12" y1="9" x2="12" y2="13"/>
    <line x1="12" y1="17" x2="12.01" y2="17"/>
  </svg>
  <div class="risk-alert-content">
    <div class="risk-alert-title">Note</div>
    <p class="risk-alert-text">If your temperature is above 103°F (39.4°C), seek medical attention promptly.</p>
  </div>
</div>`;
            }

            if (lower.includes('tired') || lower.includes('weak')) {
                return `Fatigue and weakness can have many causes. Let me understand more:

<ul style="margin: var(--space-2) 0; padding-left: var(--space-5);">
<li>How long have you been feeling this way?</li>
<li>Is it affecting your daily activities?</li>
<li>Are you getting enough sleep (7-9 hours)?</li>
<li>Any recent changes in diet or stress levels?</li>
</ul>

This information will help me provide better guidance.`;
            }

            if (lower.includes('stomach') || lower.includes('pain')) {
                return `I'm sorry to hear about your stomach pain. To help you better:

<strong>Where exactly is the pain?</strong>
<div class="chat-actions-group">
  <button class="chat-action-btn" onclick="sendQuickResponse('Upper stomach pain')">Upper area</button>
  <button class="chat-action-btn" onclick="sendQuickResponse('Lower stomach pain')">Lower area</button>
  <button class="chat-action-btn" onclick="sendQuickResponse('Pain around navel')">Around navel</button>
</div>`;
            }

            return `Thank you for sharing that. Based on what you've told me, I'd like to understand more about your symptoms.

Could you tell me:
<ol style="margin: var(--space-2) 0; padding-left: var(--space-5);">
<li>When did this start?</li>
<li>On a scale of 1-10, how severe is it?</li>
<li>Is it constant or does it come and go?</li>
</ol>

This will help me provide more accurate guidance.`;
        }

        function endSession() {
            if (confirm('Are you sure you want to end this consultation? You will receive a summary of our conversation.')) {
                addMessage(`<strong>Consultation Summary</strong>
        
<p>Thank you for using our AI Health Assistant today. Based on our conversation:</p>

<div style="background: var(--color-bg-subtle); padding: var(--space-4); border-radius: var(--radius-lg); margin: var(--space-3) 0; border: 1px solid var(--color-border);">
  <p style="margin: 0 0 var(--space-2) 0;"><strong>Risk Assessment:</strong> Low</p>
  <p style="margin: 0 0 var(--space-2) 0;"><strong>Recommendation:</strong> Monitor symptoms at home</p>
  <p style="margin: 0;"><strong>Follow-up:</strong> Consult a doctor if symptoms persist or worsen</p>
</div>

<div class="chat-actions-group">
  <button class="chat-action-btn" onclick="window.location.href='consultations.html'">View All Consultations</button>
  <button class="chat-action-btn" onclick="window.location.href='patient-dashboard.html'">Back to Dashboard</button>
</div>`, 'ai');
            }
        }
    </script>
</body>

</html>